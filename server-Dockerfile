FROM debian:stretch

USER root

ENV APPIMAGE_EXTRACT_AND_RUN=1

ADD ./lib.sh /tmp/WORKSPACE/lib.sh

RUN cd /tmp/WORKSPACE && \
  . ./lib.sh && \
  apt update && \
  apt install -y git wget && \
  install_minetest_debian_builddeps_nosudo && \
  get_minetest && \
  build_minetest_server_gnulinux_amd64

FROM alpine

COPY --from=0 /tmp/WORKSPACE/minetest/minetestserver.AppImage /usr/local/bin/minetest

